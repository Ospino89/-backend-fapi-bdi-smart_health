services:
  # Servicio de Base de Datos PostgreSQL
  - type: pserv
    name: smarthealth-db
    env: docker
    plan: free  # Cambia a 'starter' o superior en producci칩n
    region: oregon
    databases:
      - name: neondb
        user: neondb_owner

  # Servicio de API Backend
  - type: web
    name: smarthealth-api
    env: docker
    region: oregon
    plan: free  # Cambia a 'starter' o superior en producci칩n
    dockerfilePath: ./src/Dockerfile
    dockerContext: .
    
    # Variables de entorno
    envVars:
      - key: APP_ENV
        value: production
      
      - key: DB_HOST
        fromDatabase:
          name: smarthealth-db
          property: host
      
      - key: DB_PORT
        fromDatabase:
          name: smarthealth-db
          property: port
      
      - key: DB_NAME
        fromDatabase:
          name: smarthealth-db
          property: database
      
      - key: DB_USER
        fromDatabase:
          name: smarthealth-db
          property: user
      
      - key: DB_PASSWORD
        fromDatabase:
          name: smarthealth-db
          property: password
      
      - key: SECRET_KEY
        generateValue: true  # Render generar치 una clave segura
      
      - key: OPENAI_API_KEY
        sync: false  # Deber치s agregarlo manualmente en el dashboard
      
      - key: LLM_MODEL
        value: gpt-4o-mini
      
      - key: LLM_TEMPERATURE
        value: 0.1
      
      - key: LLM_MAX_TOKENS
        value: 500
      
      - key: LLM_TIMEOUT
        value: 30
    
    # Health check
    healthCheckPath: /health